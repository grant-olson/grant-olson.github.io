---
layout: default
title: Posts
---

<div id='home'>
<style type="text/css">

/* Minimal style sheet for the HTML output of Docutils.                    */
/*                                                                         */
/* :Author: Günter Milde, based on html4css1.css by David Goodger          */
/* :Id: $Id: minimal.css 8036 2017-02-14 13:05:46Z milde $               */
/* :Copyright: © 2015 Günter Milde.                                        */
/* :License: Released under the terms of the `2-Clause BSD license`_,      */
/*    in short:                                                            */
/*                                                                         */
/*    Copying and distribution of this file, with or without modification, */
/*    are permitted in any medium without royalty provided the copyright   */
/*    notice and this notice are preserved.                                */
/*                                                                         */
/*    This file is offered as-is, without any warranty.                    */
/*                                                                         */
/* .. _2-Clause BSD license: http://www.spdx.org/licenses/BSD-2-Clause     */

/* This CSS2.1_ stylesheet defines rules for Docutils elements without    */
/* HTML equivalent. It is required to make the document semantic visible. */
/*                                                                        */
/* .. _CSS2.1: http://www.w3.org/TR/CSS2                                  */
/* .. _validates: http://jigsaw.w3.org/css-validator/validator$link       */

/* alignment of text and inline objects inside block objects*/
.align-left   { text-align: left; }
.align-right  { text-align: right; }
.align-center { clear: both; text-align: center; }
.align-top    { vertical-align: top; }
.align-middle { vertical-align: middle; }
.align-bottom { vertical-align: bottom; }

/* titles */
h1.title, p.subtitle {
  text-align: center;
}
p.admonition-title,
p.topic-title,
p.sidebar-title,
p.rubric,
p.system-message-title {
  font-weight: bold;
}
h1 + p.subtitle,
h1 + p.section-subtitle {
  font-size: 1.6em;
}
h2 + p.section-subtitle { font-size: 1.28em; }
p.subtitle,
p.section-subtitle,
p.sidebar-subtitle {
  font-weight: bold;
  margin-top: -0.5em;
}
p.sidebar-title,
p.rubric {
  font-size: larger;
}
p.rubric { color: maroon; }
a.toc-backref {
  color: black;
  text-decoration: none; }

/* Warnings, Errors */
div.caution p.admonition-title,
div.attention p.admonition-title,
div.danger p.admonition-title,
div.error p.admonition-title,
div.warning p.admonition-title,
div.system-messages h1,
div.error,
span.problematic,
p.system-message-title {
  color: red;
}

/* inline literals */
span.docutils.literal {
  font-family: monospace;
  white-space: pre-wrap;
}
/* do not wraph at hyphens and similar: */
.literal > span.pre { white-space: nowrap; }

/* Lists */

/* compact and simple lists: no margin between items */
.simple  li, .compact li,
.simple  ul, .compact ul,
.simple  ol, .compact ol,
.simple > li p, .compact > li p,
dl.simple > dd, dl.compact > dd {
  margin-top: 0;
  margin-bottom: 0;
}

/* Table of Contents */
div.topic.contents { margin: 0; }
ul.auto-toc {
  list-style-type: none;
  padding-left: 1.5em; }

/* Enumerated Lists */
ol.arabic     { list-style: decimal }
ol.loweralpha { list-style: lower-alpha }
ol.upperalpha { list-style: upper-alpha }
ol.lowerroman { list-style: lower-roman }
ol.upperroman { list-style: upper-roman }

dt span.classifier { font-style: italic }
dt span.classifier:before {
  font-style: normal;
  margin: 0.5em;
  content: ":";
}

/* Field Lists and drivatives */
/* bold field name, content starts on the same line */
dl.field-list > dt,
dl.option-list > dt,
dl.docinfo > dt,
dl.footnote > dt,
dl.citation > dt {
  font-weight: bold;
  clear: left;
  float: left;
  margin: 0;
  padding: 0;
  padding-right: 0.5em;
}
/* Offset for field content (corresponds to the --field-name-limit option) */
dl.field-list > dd,
dl.option-list > dd,
dl.docinfo > dd {
  margin-left:  9em; /* ca. 14 chars in the test examples */
}
/* start field-body on a new line after long field names */
dl.field-list > dd > *:first-child,
dl.option-list > dd > *:first-child
{
  display: inline-block;
  width: 100%;
  margin: 0;
}
/* field names followed by a colon */
dl.field-list > dt:after,
dl.docinfo > dt:after {
  content: ":";
}

/* Bibliographic Fields (docinfo) */
pre.address { font: inherit; }
dd.authors > p { margin: 0; }

/* Option Lists */
dl.option-list { margin-left: 40px; }
dl.option-list > dt { font-weight: normal; }
span.option { white-space: nowrap; }

/* Footnotes and Citations  */
dl.footnote.superscript > dd {margin-left: 1em; }
dl.footnote.brackets > dd {margin-left: 2em; }
dl > dt.label { font-weight: normal; }
a.footnote-reference.brackets:before,
dt.label > span.brackets:before { content: "["; }
a.footnote-reference.brackets:after,
dt.label > span.brackets:after { content: "]"; }
a.footnote-reference.superscript,
dl.footnote.superscript > dt.label {
  vertical-align: super;
  font-size: smaller;
}
dt.label > span.fn-backref { margin-left: 0.2em; }
dt.label > span.fn-backref > a { font-style: italic; }

/* Line Blocks */
div.line-block { display: block; }
div.line-block div.line-block {
  margin-top: 0;
  margin-bottom: 0;
  margin-left: 40px;
}

/* Figures, Images, and Tables */
.figure.align-left,
img.align-left,
object.align-left,
table.align-left {
  margin-right: auto;
}
.figure.align-center,
img.align-center,
object.align-center {
  margin-left: auto;
  margin-right: auto;
  display: block;
}
table.align-center {
  margin-left: auto;
  margin-right: auto;
}
.figure.align-right,
img.align-right,
object.align-right,
table.align-right {
  margin-left: auto;
}
/* reset inner alignment in figures and tables */
/* div.align-left, div.align-center, div.align-right, */
table.align-left, table.align-center, table.align-right
{ text-align: inherit }

/* Admonitions and System Messages */
div.admonition,
div.system-message,
div.sidebar{
  margin: 40px;
  border: medium outset;
  padding-right: 1em;
  padding-left: 1em;
}

/* Sidebar */
div.sidebar {
  width: 30%;
  max-width: 26em;
  float: right;
  clear: right;
}

/* Text Blocks */
div.topic,
pre.literal-block,
pre.doctest-block,
pre.math,
pre.code {
  margin-right: 40px;
  margin-left: 40px;
}
pre.code .ln { color: gray; } /* line numbers */

/* Tables */
table { border-collapse: collapse; }
td, th {
  border-style: solid;
  border-color: silver;
  padding: 0 1ex;
  border-width: thin;
}
td > p:first-child, th > p:first-child { margin-top: 0; }
td > p, th > p { margin-bottom: 0; }

table > caption {
  text-align: left;
  margin-bottom: 0.25em
}

table.borderless td, table.borderless th {
  border: 0;
  padding: 0;
  padding-right: 0.5em /* separate table cells */
}

</style>
<style type="text/css">

/* CSS31_ style sheet for the output of Docutils HTML writers.             */
/* Rules for easy reading and pre-defined style variants.		   */
/*                                                                         */
/* :Author: Günter Milde, based on html4css1.css by David Goodger          */
/* :Id: $Id: plain.css 8120 2017-06-22 21:02:40Z milde $               */
/* :Copyright: © 2015 Günter Milde.                                        */
/* :License: Released under the terms of the `2-Clause BSD license`_,      */
/*    in short:                                                            */
/*                                                                         */
/*    Copying and distribution of this file, with or without modification, */
/*    are permitted in any medium without royalty provided the copyright   */
/*    notice and this notice are preserved.                                */
/*    	     	      	     	 					   */
/*    This file is offered as-is, without any warranty.                    */
/*                                                                         */
/* .. _2-Clause BSD license: http://www.spdx.org/licenses/BSD-2-Clause     */
/* .. _CSS3: http://www.w3.org/TR/CSS3		        		   */


/* Document Structure */
/* ****************** */

/* "page layout" */
body {
  padding: 0 5%;
  margin: 8px 0;
}
div.document {
  line-height:1.3;
  counter-reset: table;
  /* counter-reset: figure; */
  /* avoid long lines --> better reading */
  /* OTOH: lines should not be too short because of missing hyphenation, */
  max-width: 50em;
  margin: auto;
}

/* Sections */

/* Transitions */

hr.docutils {
  width: 80%;
  margin-top: 1em;
  margin-bottom: 1em;
  clear: both;
}

/* Paragraphs               */
/* ==========               */

/* vertical space (parskip) */
p, ol, ul, dl,
div.line-block,
table{
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}
h1, h2, h3, h4, h5, h6,
dl > dd {
  margin-bottom: 0.5em;
}

/* Lists                    */
/* ==========               */

/* Definition Lists         */

dl > dd > p:first-child { margin-top: 0; }
/* :last-child is not part of CSS 2.1 (introduced in CSS 3) */
dl > dd > p:last-child  { margin-bottom: 0; }

/* lists nested in definition lists */
/* :only-child is not part of CSS 2.1 (introduced in CSS 3) */
dd > ul:only-child, dd > ol:only-child { padding-left: 1em; }

/* Description Lists */
/* styled like in most dictionaries, encyclopedias etc. */
dl.description > dt {
  font-weight: bold;
  clear: left;
  float: left;
  margin: 0;
  padding: 0;
  padding-right: 0.5em;
}

/* Field Lists */

/* example for custom field-name width */
dl.field-list.narrow > dd {
  margin-left: 5em;
}
/* run-in: start field-body on same line after long field names */
dl.field-list.run-in > dd p {
  display: block;
}

/* Bibliographic Fields */

/* generally, bibliographic fields use special definition list dl.docinfo */
/* but dedication and abstract are placed into "topic" divs */
div.abstract p.topic-title {
  text-align: center;
}
div.dedication {
  margin: 2em 5em;
  text-align: center;
  font-style: italic;
}
div.dedication p.topic-title {
  font-style: normal;
}

/* Citations */
dl.citation dt.label {
  font-weight: bold;
}
span.fn-backref {
  font-weight: normal;
}

/* Text Blocks           */
/* ============          */

/* Literal Blocks           */
pre.literal-block, pre.doctest-block,
pre.math, pre.code {
  margin-left: 1.5em;
  margin-right: 1.5em
}

/* Block Quotes             */

blockquote,
div.topic {
  margin-left: 1.5em;
  margin-right: 1.5em
}
blockquote > table,
div.topic > table {
  margin-top: 0;
  margin-bottom: 0;
}
blockquote p.attribution,
div.topic p.attribution {
  text-align: right;
  margin-left: 20%;
}

/* Tables                   */
/* ======                   */

/* th { vertical-align: bottom; } */

table tr { text-align: left; }

/* "booktabs" style (no vertical lines) */
table.booktabs {
  border: 0;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.booktabs * {
  border: 0;
}
table.booktabs th {
  border-bottom: thin solid;
}

/* numbered tables (counter defined in div.document) */
table.numbered > caption:before {
  counter-increment: table;
  content: "Table " counter(table) ": ";
  font-weight: bold;
}

/* Explicit Markup Blocks   */
/* ======================   */

/* Footnotes and Citations  */
/* -----------------------  */

/* line on the left */
dl.footnote {
  padding-left: 1ex;
  border-left: solid;
  border-left-width: thin;
}

/* Directives               */
/* ----------               */

/* Body Elements            */
/* ~~~~~~~~~~~~~            */

/* Images and Figures */

/* let content flow to the side of aligned images and figures */
.figure.align-left,
img.align-left,
object.align-left {
  display: block;
  clear: left;
  float: left;
  margin-right: 1em
}
.figure.align-right,
img.align-right,
object.align-right {
  display: block;
  clear: right;
  float: right;
  margin-left: 1em
}
/* Stop floating sidebars, images and figures at section level 1,2,3 */
h1, h2, h3 { clear: both; }

/* Sidebar */

/* Move into the margin. In a layout with fixed margins, */
/* it can be moved into the margin completely.		 */
div.sidebar {
  width: 30%;
  max-width: 26em;
  margin-left: 1em;
  margin-right: -5.5%;
  background-color: #ffffee ;
}

/* Code                     */

pre.code, code { background-color: #eeeeee }
pre.code .ln { color: gray; } /* line numbers */
/* basic highlighting: for a complete scheme, see */
/* http://docutils.sourceforge.net/sandbox/stylesheets/ */
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

/* Math                     */
/* styled separately (see math.css for math-output=HTML) */

/* Epigraph                 */
/* Highlights               */
/* Pull-Quote               */
/* Compound Paragraph       */
/* Container                */

/* can be styled in a custom stylesheet */

/* Document Header and Footer */

div.footer, div.header {
  clear: both;
  font-size: smaller;
}

/* Inline Markup            */
/* =============            */

/* Emphasis                 */
/*   em                     */
/* Strong Emphasis          */
/*   strong		    */
/* Interpreted Text         */
/*   span.interpreted  	    */
/* Title Reference 	    */
/*   cite		    */
/* Inline Literals          */
/* possible values: normal, nowrap, pre, pre-wrap, pre-line */
/*   span.docutils.literal { white-space: pre-wrap; } */

/* Hyperlink References     */
a { text-decoration: none; }

/* External Targets         */
/*   span.target.external   */
/* Internal Targets  	    */
/*   span.target.internal   */
/* Footnote References      */
/*   a.footnote-reference   */
/* Citation References      */
/*   a.citation-reference   */

</style>
<div class="document" id="pyasm-user-s-guide-v-0-3">
<h1 class="title">pyasm User's Guide V. 0.3</h1>

<p class="subtitle" id="by-grant-olson-kgo-at-grant-olson-dot-net">by Grant Olson &lt;kgo at grant-olson dot net&gt;</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id1">Introduction</a></p>
<ul>
<li><p><a class="reference internal" href="#installation" id="id2">Installation</a></p></li>
<li><p><a class="reference internal" href="#hello-world" id="id3">Hello World!</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#everyday-usage" id="id4">Everyday usage</a></p>
<ul>
<li><p><a class="reference internal" href="#assembler-syntax" id="id5">Assembler Syntax</a></p>
<ul>
<li><p><a class="reference internal" href="#instruction-statements" id="id6">Instruction Statements</a></p></li>
<li><p><a class="reference internal" href="#assembler-directives" id="id7">Assembler Directives</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#typical-usage" id="id8">Typical Usage</a></p></li>
<li><p><a class="reference internal" href="#assembly-via-the-api" id="id9">Assembly via the API</a></p></li>
<li><p><a class="reference internal" href="#command-line-assembler" id="id10">Command-line assembler</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#debugging-tips" id="id11">Debugging Tips</a></p>
<ul>
<li><p><a class="reference internal" href="#linux-debuggers" id="id12">Linux Debuggers</a></p></li>
<li><p><a class="reference internal" href="#windows-debuggers" id="id13">Windows debuggers</a></p></li>
<li><p><a class="reference internal" href="#source-output-not-implemented-yet" id="id14">Source output - <em>not implemented yet</em></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#feel-like-contributing" id="id15">Feel like contributing?</a></p>
<ul>
<li><p><a class="reference internal" href="#adding-x86-instructions" id="id16">Adding x86 instructions</a></p></li>
<li><p><a class="reference internal" href="#elf-serialization-deserialization" id="id17">ELF serialization/deserialization</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h1><a class="toc-backref" href="#id1">Introduction</a></h1>
<p>Pyasm is a full-featured dynamic assembler written entirely in Python.  By
dynamic, I mean that it can be used to generate and execute machine code in
python at runtime without requiring the generation of object files and linkage.
It essentially allow 'inline' assembly in python modules on x86 platforms.</p>
<p>Pyasm can also generate object files (for windows) like a traditional
standalone assembler, although you're probably better off using one of the many
freely available assemblers if this is you primary goal.</p>
<div class="section" id="installation">
<h2><a class="toc-backref" href="#id2">Installation</a></h2>
<p>Pyasm currently requires python 2.6.</p>
<p>Linux Install:</p>
<blockquote>
<ul class="simple">
<li><p>Download and extract <a class="reference external" href="http://www.grant-olson.net/python/pyasm/pyasm-0.3.tar.gz?attredirects=0&amp;d=1">pyasm-0.3.tar.gz</a></p></li>
<li><p>python setup.py install</p></li>
</ul>
</blockquote>
<p>Windows Install:</p>
<blockquote>
<ul class="simple">
<li><p>Download and run <a class="reference external" href="http://www.grant-olson.net/python/pyasm/pyasm-0.3.win32-py2.6.exe.zip?attredirects=0&amp;d=1">pyasm-0.3.win32-py2.6.exe</a></p></li>
<li><p>A source distribution <a class="reference external" href="http://www.grant-olson.net/python/pyasm/pyasm-0.3.zip?attredirects=0&amp;d=1">pyasm-0.3.zip</a> is available, but you'll need VS7.0 to
compile the excmem module.</p></li>
</ul>
</blockquote>
</div>
<div class="section" id="hello-world">
<h2><a class="toc-backref" href="#id3">Hello World!</a></h2>
<p>A simple Windows version of a hello_world.py program is as follows:</p>
<pre class="literal-block">#
# Hello World in assembly:  pyasm/examples/hello_World.py
#
#

from pyasm import pyasm

pyasm(globals(),r&quot;&quot;&quot;
   !PROC hello_world PYTHON
   !ARG  self
   !ARG  args
        !CALL PySys_WriteStdout &quot;Hello, World!\n\0&quot;
        ADD ESP, 0x4
        MOV EAX,PyNone
        ADD [EAX],1
   !ENDPROC
   &quot;&quot;&quot;)

hello_world()</pre>
<p>A brief description of what is happening durring the pyasm call:</p>
<blockquote>
<ol class="arabic">
<li><p>the globals() statement tells pyasm where to bind newly created python
functions</p></li>
<li><p>The !CHARS directive creates a string constant.</p></li>
<li><p>The !PROC and !ARG directives create a procedure that matches the
standard CPythonFunction signature [PyObject* hello_world(PyObject* self,
PyObject* args) and create procedure initialization code.</p></li>
<li><p>The procedure calls python's PySys_WriteStdout function.  Since python functions
use CDECL calling conventions, we:</p>
<blockquote>
<ol class="loweralpha simple">
<li><p>PUSH the paramters onto the stack from right to left</p></li>
<li><p>CALL the function</p></li>
<li><p>Cleanup the stack ourselves</p></li>
</ol>
</blockquote>
</li>
<li><p>PyCFunctions must return some sort of python object, so we:</p>
<blockquote>
<ol class="loweralpha simple">
<li><p>Load PyNone into the EAX register, which will become the return value.</p></li>
<li><p>Add one to the reference count</p></li>
</ol>
</blockquote>
</li>
</ol>
<p>6. The !ENDPROC directive ends the procedure and creates function cleanup
code.  This creates a procedure called hello_world that would have the C
signature of <cite>PyObject* hello_world(PyObject* self, PyObject* args)</cite>.  The
procedure loads hello_str onto the stack, calls the python interpreters
PySys_WriteStdout function,</p>
<ol class="arabic simple" start="7">
<li><p>Calling hello_world() executes the newly created function.</p></li>
</ol>
</blockquote>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The rest of this document assumes that you know x86 assembly language.  A
tutorial is beyond the scope of this document.  If you don't know assembly
language, you'll want to read an introductory text (such as <em>The Art of
Assembly Language</em>) as well as downloading Volumes 2 and 3 of the <em>IA-32
Intel Architecture Software Developer's Manual</em> for reference.</p>
</div>
</div>
</div>
<div class="section" id="everyday-usage">
<h1><a class="toc-backref" href="#id4">Everyday usage</a></h1>
<div class="section" id="assembler-syntax">
<h2><a class="toc-backref" href="#id5">Assembler Syntax</a></h2>
<p>Like most assemblers, the command-line assembler contains a very simple parser.
There two basic statements that can be used.  An <em>instruction statement</em> and an
<em>assembler directive</em>.  <em>Assembler directives</em> contain information that makes
your assembly a little easier to read than raw assembly code, such as the
begining and ending of function; declaration of parameters, variables,
constants and data; and other stuff.  <em>Instruction Statements</em> consist of real
assembly instructions such as <cite>MOV [EAX+4],value</cite></p>
<p>Additional notes specific to this assembler are as follows:</p>
<blockquote>
<ul class="simple">
<li><p>Numbers use python's formatting scheme, so hex is represented as 0xFF and not FFh.</p></li>
<li><p>Instructions and Registers must be in all caps.  mov eax,0x0 is invalid.</p></li>
</ul>
</blockquote>
<div class="section" id="instruction-statements">
<h3><a class="toc-backref" href="#id6">Instruction Statements</a></h3>
<p>Instruction statements are reasonably straightforward if you know x86 assembly
language.</p>
</div>
<div class="section" id="assembler-directives">
<h3><a class="toc-backref" href="#id7">Assembler Directives</a></h3>
<p>Assembler directives begin with an exclamation mark, followed by the directive
itself, and followed by any applicable parameters.  Keep in mind that these
directives are provided for the programmer's convienence.  Anything that is
done via a directive could be translated into raw assembly, it's just not as
readable.</p>
<table>
<colgroup>
<col style="width: 29%" />
<col style="width: 24%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr><th class="head"><p>Text Directive</p></th>
<th class="head"><p>API Call</p></th>
<th class="head"><p>Brief Description</p></th>
</tr>
</thead>
<tbody>
<tr><td><p><strong>!CALL proc [arg arg]</strong></p></td>
<td><p><em>n/a</em></p></td>
<td><p>Procedure call framework</p></td>
</tr>
<tr><td><p><strong>!CHARS name value</strong></p></td>
<td><p><strong>.AStr(n,v)</strong></p></td>
<td><p>Create a character array (aka a string)</p></td>
</tr>
<tr><td><p><strong>!COMMENT text</strong></p></td>
<td><p><em>n/a</em></p></td>
<td><p>Comment line.</p></td>
</tr>
<tr><td><p><strong>!CONST name value</strong></p></td>
<td><p><strong>.AC(n,v)</strong></p></td>
<td><p>Create a constant value.</p></td>
</tr>
<tr><td><p><strong>!LABEL name</strong></p></td>
<td><p><strong>.AIL(name)</strong></p></td>
<td><p>Provide a symbolic label for later ref.</p></td>
</tr>
<tr><td><p><strong>!PROC name [type]</strong></p></td>
<td><p><strong>.AP(name,type)</strong></p></td>
<td><p>Begin a procedure.</p></td>
</tr>
<tr><td><p><strong>!ARG argname [size]</strong></p></td>
<td><p><strong>.AA(name,size)</strong></p></td>
<td><p>Add an argument to a procedure def.</p></td>
</tr>
<tr><td><p><strong>!LOCAL varname [size]</strong></p></td>
<td><p><strong>.ALoc(name,size)</strong></p></td>
<td><p>Add a local var to a procedure def.</p></td>
</tr>
<tr><td><p><strong>!ENDPROC</strong></p></td>
<td><p><strong>.EP()</strong></p></td>
<td><p>End a procedure</p></td>
</tr>
</tbody>
</table>
<dl class="simple">
<dt>!CALL proc [arg arg arg]</dt>
<dd><p>A convienence function for procedure calling.  PUSHes arguments onto the
stack from right to left and calls the appropriate procedure.  Stack cleanup
(if any) is still the programmer's responsibility.</p>
</dd>
<dt>!CHARS name value</dt>
<dd><p>Create a character array (aka a string)</p>
</dd>
<dt>!COMMENT text</dt>
<dd><p>Ignore this line.</p>
</dd>
<dt>!CONST name value</dt>
<dd><p>Just declares a constant that is replaced in subsequent occurances.  Keep in
mind that this is resolved at compile time, so the values should really only
be numbers.  !CONST hello_world &quot;hello world\n\0&quot; is invalid.</p>
</dd>
<dt>!LABEL name</dt>
<dd><p>Provide a symbolic label to the current memory address.  Primarily used for
loops, if-then logic, etc.  You can use a label and hand-roll a procedure,
but you probably want to use the !PROC directive instead.</p>
</dd>
<dt>!PROC name[type]</dt>
<dd><p>Begin a procedure.  This will emit the boilerplate code to start a procedure.
Arguments and Local variables can be declared with !ARG and !LOCAL directives
listed below.  These declarations must occur before any instruction
statements or an error will occur.  This will generate the boilerplate
function startup code, which consists of PUSHing the EBP register, copying
the current location of ESP, and translating arguments and local variables
into references via the offset of the EBP pointer.  If the previous sentence
didn't make any sense to you, just remember that the EBP register shouldn't
be manipulatedin your code here or things will get screwed up.</p>
</dd>
<dt>!ARG argname [size]</dt>
<dd><p>An argument passed to a procedure via the stack.  By default, we assume the
size is 4 bytes although you can specify if you need to.</p>
</dd>
<dt>!LOCAL varname [size]</dt>
<dd><p>A local variable maintained on the procedure's stack frame.</p>
</dd>
<dt>!ENDPROC</dt>
<dd><p>End a procedure.  Emit the cleanup code as the caller's responsibility.]</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="typical-usage">
<h2><a class="toc-backref" href="#id8">Typical Usage</a></h2>
<p>Typically, usage is as simple as the hello world example listed above.  Import
the pyasm function from the pyasm package and call it.  globals blah blah blah.</p>
</div>
<div class="section" id="assembly-via-the-api">
<h2><a class="toc-backref" href="#id9">Assembly via the API</a></h2>
<p>calling pyasm is fine if you're just trying to inline some assembly functions,
but if you're trying to dynamically generate assembly (such as writing a python
compiler) you're better off accessing the api directly.  This involves a few
steps:</p>
<blockquote>
<ol class="arabic simple">
<li><p>import the assembler class from x86 asm and instantiate.</p></li>
<li><p>Add instructions either as strings that need to be preprocessed or via the api.</p></li>
<li><p>generate an intermediate 'codepackage' by calling the .Compile() method</p></li>
<li><p>transform the codePackage to runtime memory via CpToMemory.</p></li>
</ol>
</blockquote>
</div>
<div class="section" id="command-line-assembler">
<h2><a class="toc-backref" href="#id10">Command-line assembler</a></h2>
<p><strong>NOT IMPLEMENTED YET</strong></p>
<p>If you really want to, a command-line asembler is available for usage.  Usage
is straightforward:</p>
<pre class="literal-block">python pyassemble.py asmfile.asm</pre>
<p>This will generate an object file asmfile.o that can be used by your linker.</p>
</div>
</div>
<div class="section" id="debugging-tips">
<h1><a class="toc-backref" href="#id11">Debugging Tips</a></h1>
<p>If you write assembly, chances are that you are going to crash your app at one
point or another.</p>
<div class="section" id="linux-debuggers">
<h2><a class="toc-backref" href="#id12">Linux Debuggers</a></h2>
<p>On Linux, you obviously have gdb.</p>
</div>
<div class="section" id="windows-debuggers">
<h2><a class="toc-backref" href="#id13">Windows debuggers</a></h2>
<p>Contrary to popular belief, there is a buildin command-line debugger on Windows
NT/2000/XP called ntsd.exe that can be used in a bind.  If you're doing any
serious work though, do yourself a favor and download the 18MB &quot;Debugging Tools
for Windows.&quot;  It includes an updated version of ntsd.exe and a version with a
simple Windows interface called WinDBG.  You'll really want to download this if
you're getting serious about assembly debugging.  Actual usage is beyond the
scope of this document, but read up on setting up a symbol server.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>After installing, you may want to register WinDBG as the default
debugger by cd'ing to the program directory and issuing 'windbg -I'  This will
cause WinDBG to spawn automatically when any program crashes or executes an INT
3 instruction.  It also has the added benefit of making friends and co-workers
think that you're a much more hardcore programmer than you really are.  The
jury is still out as to whether this impresses the ladies or not.</p>
</div>
<p>And yes, there is the Visual Studio .NET debugger.  This is a great debugger
when you're debugging C or VB code in an existing project.  But it is
designed to work as part of an IDE.  It gets a little wierd when debugging
raw assembly or compiled code without the source floating around.  As ugly as
WinDBG's gui looks like by todays standards, it is a lot more convienent in
these cases.</p>
</div>
<div class="section" id="source-output-not-implemented-yet">
<h2><a class="toc-backref" href="#id14">Source output - <em>not implemented yet</em></a></h2>
<p>I plan to provide a hook via the logging module so you can obtain disassembly
of the source at runtime.</p>
</div>
</div>
<div class="section" id="feel-like-contributing">
<h1><a class="toc-backref" href="#id15">Feel like contributing?</a></h1>
<p>Any and all patches will be considered.  If you're planning on implenting
anything serious you may want to run it by me so you don't end up wasting your
time.  There is some low-hanging fruit  out there though.</p>
<div class="section" id="adding-x86-instructions">
<h2><a class="toc-backref" href="#id16">Adding x86 instructions</a></h2>
<p>I haven't added all of the x86 instructions yet.  Most of it involves cutting
and pasting from the IA32 Intel Software Architecture Manual Volumes 2 and 3.
For standard instructions, you should just be able to add the appropriate text
to x86inst.py and creating a test in test_instructions.py.  SIMD and FPU
operations will probably require some additional hacking.</p>
</div>
<div class="section" id="elf-serialization-deserialization">
<h2><a class="toc-backref" href="#id17">ELF serialization/deserialization</a></h2>
<p>There is currently code that converts windows COFF objects to a python-based
object model and vice versa.  This allows you to create standard object files
for traditional linking.  An equivilent for ELF files would allow you to do the
same thing in Linux.  Refer to the coff*.py files to see how this format was
implemented.</p>
</div>
</div>
</div>
</div>